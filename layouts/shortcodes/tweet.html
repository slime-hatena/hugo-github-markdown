{{/* See: https://github.com/gohugoio/hugo/blob/master/tpl/tplimpl/embedded/templates/shortcodes/twitter.html */}}
{{- $pc := .Page.Site.Config.Privacy.Twitter -}}
{{- if .Site.Params.alternativeTweet -}}
  {{- if not $pc.Disable -}}
    {{- if $pc.Simple -}}
      {{- template "_internal/shortcodes/twitter_simple.html" . -}}
    {{- else -}}
      {{- $msg1 := "The %q shortcode requires two named parameters: user and id. See %s" -}}
      {{- $msg2 := "The %q shortcode will soon require two named parameters: user and id. See %s" -}}
      {{- if .IsNamedParams -}}
        {{- $id := .Get "id" -}}
        {{- $user := .Get "user" -}}
        {{- if and $id $user -}}
          {{- template "render-tweet-alternative" (dict "id" $id "user" $user "dnt" $pc.EnableDNT) -}}
        {{- else -}}
          {{- errorf $msg1 .Name .Position -}}
        {{- end -}}
      {{- else -}}
        {{- $id := .Get 1 -}}
        {{- $user := .Get 0 -}}
        {{- if eq 1 (len .Params) -}}
          {{- $id = .Get 0 -}}
          {{- $user = "twitter" -}} {{/* This triggers a redirect. It works, but may not work forever. */}}
          {{- warnf $msg2 .Name .Position -}}
        {{- end -}}
        {{- template "render-tweet-alternative" (dict "id" $id "user" $user "dnt" $pc.EnableDNT) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- else -}}
  {{- template "_internal/shortcodes/twitter.html" . -}}
{{- end -}}

{{- define "render-tweet-alternative" -}}
<div id="tweet-{{ .id }}">
  <blockquote class="twitter-tweet-prepare">
    <a href="https://twitter.com/{{ .user }}/status/{{ .id }}" target="_blank">Tweet: {{ .id }}</a><br>
    If it does not load properly, it may have been made private or deleted.
  </blockquote>
</div>
<script>
  {
    const blockquote = document.querySelector("#tweet-{{ .id }}>blockquote");
    if (window.matchMedia('(prefers-color-scheme: dark)').matches != true) {
      blockquote.dataset.theme = "light";
    } else {
      blockquote.dataset.theme = "dark";
    }
    blockquote.className = "twitter-tweet";
  }
</script>
{{- end -}}
